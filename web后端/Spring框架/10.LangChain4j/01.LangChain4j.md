# LangChain4j ğŸ¤–

## ä¸€ã€Spring Boot é›†æˆ ğŸš€

### 1. æ”¯æŒçš„ç‰ˆæœ¬

- âœ… Spring Boot 3.2
- âœ… JDK 17

### 2. ä¾èµ–é…ç½®

> Spring Boot Starter å¯ä»¥å¸®åŠ©ä½ é€šè¿‡é…ç½®æ–‡ä»¶å¿«é€Ÿåˆ›å»ºå’Œé…ç½®è¯­è¨€æ¨¡å‹ã€å‘é‡æ¨¡å‹ã€å‘é‡å­˜å‚¨ï¼Œä»¥åŠå…¶ä»– LangChain4j æ ¸å¿ƒç»„ä»¶ã€‚          
> ä¾èµ–å‘½åè§„èŒƒä¸ºï¼š`langchain4j-{integration-name}-spring-boot-starter`ã€‚

![img.png](img/img.png)

```xml
<dependency>
    <groupId>dev.langchain4j</groupId>
    <artifactId>langchain4j-open-ai-spring-boot-starter</artifactId>
    <version>1.3.0-beta9</version>
</dependency>
```


### 3. é…ç½®æ–‡ä»¶è®¾ç½®

> **æç¤º**ï¼šåœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œå°† `{api-key}`ã€`{model-name}` å’Œ `{base-url}` æ›¿æ¢ä¸ºå®é™…å€¼

```yml
langchain4j:
  open-ai:
    chat-model:
      api-key: {api-key}  # ä½ çš„OpenAI APIå¯†é’¥
      model-name: {model-name}  # å¦‚ gpt-3.5-turbo æˆ– gpt-4
      base-url: {base-url}  # å¯é€‰ï¼Œè‡ªå®šä¹‰APIåŸºç¡€URL
      log-requests: true    # å¼€å‘é˜¶æ®µå»ºè®®å¼€å¯ï¼Œä¾¿äºè°ƒè¯•
      log-responses: true   # å¼€å‘é˜¶æ®µå»ºè®®å¼€å¯ï¼Œä¾¿äºè°ƒè¯•
```


### 4. ç®€å•è°ƒç”¨ç¤ºä¾‹

> **åˆå­¦è€…æç¤º**ï¼šè¿™æ˜¯æœ€åŸºç¡€çš„è°ƒç”¨æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨ `OpenAiChatModel` è¿›è¡ŒèŠå¤©

```java
@RestController
public class ChatController {
    @Autowired
    private OpenAiChatModel chatModel;

    @GetMapping("/chat")
    public String chat(@RequestParam(value = "message", defaultValue = "Hello") String message) {
        return chatModel.chat(message);
    }
}
```


## äºŒã€AI Service æ¨¡å¼ ğŸ§ 

- LangChain4j æä¾›äº†ä¸€ä¸ª Spring Boot Starterï¼Œç”¨äºè‡ªåŠ¨é…ç½® AI Servicesã€RAGã€Tools ç­‰ã€‚
- **ä¼˜åŠ¿**ï¼šæ›´ç®€æ´çš„å¼€å‘æ–¹å¼ï¼Œä½¿ç”¨æ³¨è§£é©±åŠ¨çš„AIæœåŠ¡æ¥å£

### 1. ä¾èµ–é…ç½®

```xml
<dependency>
    <groupId>dev.langchain4j</groupId>
    <artifactId>langchain4j-spring-boot-starter</artifactId>
    <version>1.3.0-beta9</version>
</dependency>
```


### 2. å®šä¹‰AIæœåŠ¡æ¥å£

> **æ³¨æ„**ï¼šä½¿ç”¨ `@AiService` æ³¨è§£çš„æ¥å£ä¼šè¢«è‡ªåŠ¨å®ç°

```java
@AiService
interface Assistant {
    @SystemMessage("ä½ æ˜¯ä¸€åJavaåç«¯å¼€å‘è€…ï¼Œè¯·å›ç­”ç”¨æˆ·é—®é¢˜")
    String chat(String userMessage);
}
```


### 3. è°ƒç”¨AIæœåŠ¡æ¥å£

```java
@RestController
class AssistantController {
    @Autowired
    Assistant assistant;

    @GetMapping("/chat")
    public String chat(String message) {
        return assistant.chat(message);
    }
}
```


## ä¸‰ã€è‡ªåŠ¨ç»„ä»¶æ³¨å…¥ âš™ï¸

å¦‚æœä¸Šä¸‹æ–‡ä¸­å­˜åœ¨ä»¥ä¸‹ç»„ä»¶ï¼Œå®ƒä»¬ä¼šè¢«è‡ªåŠ¨æ³¨å…¥åˆ° AI Serviceï¼š

- `ChatModel` - èŠå¤©æ¨¡å‹
- `StreamingChatModel` - æµå¼èŠå¤©æ¨¡å‹
- `ChatMemory` - èŠå¤©è®°å¿†
- `ChatMemoryProvider` - èŠå¤©è®°å¿†æä¾›è€…
- `ContentRetriever` - å†…å®¹æ£€ç´¢å™¨
- `RetrievalAugmentor` - æ£€ç´¢å¢å¼ºå™¨
- æ‰€æœ‰ `@Component` æˆ– `@Service` ç±»ä¸­å¸¦ `@Tool` æ³¨è§£çš„æ–¹æ³•

> **æç¤º**ï¼šè‡ªåŠ¨æ³¨å…¥ç®€åŒ–äº†é…ç½®ï¼Œé€‚åˆå•ä¸ªAIæœåŠ¡çš„åœºæ™¯

## å››ã€æ˜¾å¼ç»„ä»¶æ³¨å…¥ ğŸ”§

- å¦‚æœä½ æœ‰å¤šä¸ª AI Serviceï¼Œä¸”éœ€è¦ä¸ºå®ƒä»¬åˆ†åˆ«æŒ‡å®šä¸åŒçš„ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ `@AiService(wiringMode = EXPLICIT)` æ¥å¯ç”¨æ˜¾å¼æ³¨å…¥ã€‚

> **ä½¿ç”¨åœºæ™¯**ï¼šå½“é¡¹ç›®ä¸­éœ€è¦å¤šä¸ªä¸åŒé…ç½®çš„AIæœåŠ¡æ—¶

```java
@AiService(wiringMode = EXPLICIT, chatModel = "openAiChatModel")
interface OpenAiAssistant {
    @SystemMessage("You are a polite assistant")
    String chat(String userMessage);
}

@AiService(wiringMode = EXPLICIT, chatModel = "ollamaChatModel")
interface OllamaAssistant {
    @SystemMessage("You are a polite assistant")
    String chat(String userMessage);
}
```


## äº”ã€ç›‘å¬ AI Service æ³¨å†Œäº‹ä»¶ ğŸ“¡

- LangChain4j æä¾›äº†ä¸€ä¸ª `ApplicationListener<AiServiceRegisteredEvent>` æ¥å£ï¼Œç”¨äºç›‘å¬ AI Service çš„æ³¨å†Œäº‹ä»¶ã€‚
- **ç”¨é€”**ï¼šå¯ç”¨äºè°ƒè¯•ã€æ—¥å¿—è®°å½•æˆ–åŠ¨æ€ç®¡ç†AIæœåŠ¡

```java
@Component
class AiServiceRegisteredEventListener implements ApplicationListener<AiServiceRegisteredEvent> {
    @Override
    public void onApplicationEvent(AiServiceRegisteredEvent event) {
        Class<?> aiServiceClass = event.aiServiceClass();
        List<ToolSpecification> toolSpecifications = event.toolSpecifications();
        for (int i = 0; i < toolSpecifications.size(); i++) {
            System.out.printf("[%s]: [Tool-%s]: %s%n", 
                aiServiceClass.getSimpleName(), 
                i + 1, 
                toolSpecifications.get(i));
        }
    }
}
```


## å…­ã€Flux æµå¼å“åº” ğŸŒŠ

- LangChain4j æä¾›äº† `Flux` å°è£…ï¼Œç”¨äºæµå¼è¾“å‡ºã€‚
- **ä¼˜åŠ¿**ï¼šæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå¯ä»¥çœ‹åˆ°AIé€æ­¥ç”Ÿæˆå›å¤çš„è¿‡ç¨‹

### 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>dev.langchain4j</groupId>
    <artifactId>langchain4j-reactor</artifactId>
    <version>1.3.0-beta9</version>
</dependency>
```


### 2. ä½¿ç”¨Fluxå®ç°æµå¼å“åº”

```java
@AiService
interface Assistant {
    @SystemMessage("ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹")
    Flux<String> chat(String userMessage);
}
```


> **ä½¿ç”¨æç¤º**ï¼šFluxæ¨¡å¼é€‚åˆéœ€è¦å®æ—¶æµå¼è¾“å‡ºçš„åœºæ™¯ï¼Œå¦‚å®æ—¶å¯¹è¯æˆ–é€æ­¥æ€è€ƒè¿‡ç¨‹å±•ç¤º

### 3. å‰ç«¯å¤„ç†æµå¼å“åº”ç¤ºä¾‹

```javascript
// JavaScriptç¤ºä¾‹ï¼šå¤„ç†Fluxæµå¼å“åº”
fetch('/chat?message=ä½ å¥½')
  .then(response => {
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    
    function readStream() {
      reader.read().then(({done, value}) => {
        if (done) {
          console.log('æµç»“æŸ');
          return;
        }
        const chunk = decoder.decode(value);
        console.log(chunk); // æ˜¾ç¤ºAIçš„é€æ­¥å›å¤
        readStream();
      });
    }
    readStream();
  });
```