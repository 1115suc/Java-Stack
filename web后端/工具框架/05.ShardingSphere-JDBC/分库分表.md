# 📚 分库分表核心概念总结

## 一、分库分表概述 📊

### 为什么要分库分表？

- **根本原因**：解决由于数据量过大导致数据库性能降低的问题
- **触发条件**：单表数据量达到1000W或100G后，查询性能急剧下降
- **核心目标**：使单一数据库、单一数据表的数据量变小，提升数据库性能

### 性能瓶颈分析

**数据库成为瓶颈的原因：**

- 单机存储容量、连接数、处理能力有上限
- 大表关联查询性能差
- I/O成为主要瓶颈

**优化方案对比：**


| 方案     | 优点       | 缺点             |
| -------- | ---------- | ---------------- |
| 硬件升级 | 简单直接   | 成本高，提升有限 |
| 分库分表 | 效果显著   | 复杂度高         |
| 缓存优化 | 缓解读压力 | 无法解决根本问题 |

## 二、四种分库分表方式 🔧

### 1. 垂直分表（同一数据库，字段拆分）

**定义**：将一张表按字段拆分成多个表，表结构变化
**场景**：冷热数据分离（如商品基本信息 vs 商品描述）
**原则**：

- 不常用字段单独成表
- text/blob大字段必须拆分
- 经常组合查询的字段放同一表

**优点**：

- 提高热点数据操作效率
- 减少I/O争抢和锁表几率

### 2. 垂直分库（按业务分库）

**定义**：按业务将表归类，分布到不同数据库
**理念**：专库专用
**示例**：商品库 + 店铺库分别部署在不同服务器

**优点**：

- 业务清晰，便于维护
- 支持分级管理和扩展
- 提高磁盘I/O和连接数

**缺点**：依然没有解决单表数据量过大的问题

### 3. 水平分表（同一数据库，数据行拆分）

**定义**：同一数据库内，按规则将数据拆分到多个相同结构的表
**示例**：商品ID单数→表1，双数→表2
**算法**：`t_order_${order_id % 2 + 1}`

**优点**：

- 解决单表数据量大的问题
- 避免I/O争抢，减少锁表

**缺点**：仅解决单表问题，未解决单库问题

### 4. 水平分库（不同数据库，数据行拆分）

**定义**：水平分表的进一步拆分，数据分布到不同数据库
**场景**：单库存储量及性能达到瓶颈时
**示例**：商品ID单数→库1，双数→库2

**优点**：

- 解决单库大数据、高并发问题
- 提高系统稳定性和可用性

**缺点**：增加系统复杂度，需要解决数据路由问题

## 三、分库分表带来的挑战 😕 

### 核心问题

1. **分布式事务一致性**
2. **跨节点关联查询**
3. **跨节点分页、排序**
4. **主键避重**
5. **公共表处理**

### 解决方案

- 使用中间件：Sharding-JDBC、MyCat
- 合理设计分片键
- 避免跨库关联查询

## 四、最佳实践总结 📋

### 实施顺序

1. **系统设计阶段**：优先考虑垂直分库、垂直分表
2. **数据量增长期**：考虑缓存、读写分离、索引优化
3. **大数据量期**：最后考虑水平分库、水平分表

### 核心原则

- **非必须，不拆分**：基于成本考虑，谨慎选择分库分表
- **业务优先**：从业务角度设计拆分方案
- **避免关联**：尽量减少跨库跨表查询

### 四种方式对比


| 方式     | 拆分维度 | 解决的问题   | 复杂度 |
| -------- | -------- | ------------ | ------ |
| 垂直分表 | 字段     | 冷热数据分离 | 低     |
| 垂直分库 | 业务     | 专库专用     | 中     |
| 水平分表 | 数据行   | 单表数据量大 | 中     |
| 水平分库 | 数据行   | 单库数据量大 | 高     |
