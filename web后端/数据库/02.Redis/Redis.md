# ğŸš€ RedisåŸºç¡€

## ğŸ“š è¯¾ç¨‹å†…å®¹

- âœ¨ Rediså…¥é—¨
- ğŸ”¢ Redisæ•°æ®ç±»å‹
- âŒ¨ï¸ Rediså¸¸ç”¨å‘½ä»¤
- ğŸ¯ Redisä½¿ç”¨åœºæ™¯
- â˜• åœ¨Javaä¸­æ“ä½œRedis

---

## 1. âœ¨ Rediså…¥é—¨

### 1.1 ğŸ¯ Redisç®€ä»‹

#### ã€1ã€‘ä¸ºä»€ä¹ˆå­¦ä¹ Redis ğŸ¤”

![image-20221210175801848](assets/image-20221210175801848.png)

Redisæ˜¯ä¸€ä¸ªåŸºäº**å†…å­˜**çš„key-valueç»“æ„æ•°æ®åº“ã€‚å®ƒæ˜¯ã€Œ**Re**mote **Di**ctionary **S**erviceã€çš„é¦–å­—æ¯ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯ã€Œè¿œç¨‹å­—å…¸æœåŠ¡-remote dictionary serverã€ã€‚

- [ ] åŸºäºå†…å­˜å­˜å‚¨ï¼Œè¯»å†™æ€§èƒ½é«˜ âš¡

![image-20210927090555559](assets/image-20210927090555559.png)

- [ ] é€‚åˆå­˜å‚¨çƒ­ç‚¹æ•°æ®ï¼ˆçƒ­ç‚¹å•†å“ã€èµ„è®¯ã€æ–°é—»ï¼‰ğŸ”¥

![image-20210927090604994](assets/image-20210927090604994.png)

- [ ] ä¼ä¸šåº”ç”¨å¹¿æ³› ğŸ¢

![image-20210927090612540](assets/image-20210927090612540.png)

#### ã€2ã€‘Redisä»‹ç» ğŸ“–

Redis is an open source (BSD licensed), in-memory data structure store, used as a database, cache, and message broker. ç¿»è¯‘ä¸ºï¼šRedisæ˜¯ä¸€ä¸ªå¼€æºçš„å†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œï¼šæ•°æ®åº“ã€ç¼“å­˜ç­‰ã€‚

å®˜ç½‘ï¼š[https://redis.io](https://redis.io/)

ä¸­æ–‡ç½‘   https://www.redis.net.cn/

Redisæ˜¯ç”¨Cè¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½é”®å€¼å¯¹(key-value)æ•°æ®åº“ï¼Œå®˜æ–¹æä¾›çš„æ•°æ®æ˜¯å¯ä»¥è¾¾åˆ°10ä¸‡+çš„QPSï¼ˆQueries-per-secondæ¯ç§’å†…æŸ¥è¯¢æ¬¡æ•°ï¼‰ã€‚å®ƒå­˜å‚¨çš„valueç±»å‹æ¯”è¾ƒä¸°å¯Œï¼Œä¹Ÿè¢«ç§°ä¸ºç»“æ„åŒ–çš„NoSqlæ•°æ®åº“ã€‚

NoSqlï¼ˆNot Only SQLï¼‰ï¼Œä¸ä»…ä»…æ˜¯SQLï¼Œæ³›æŒ‡**éå…³ç³»å‹æ•°æ®åº“(æ•°æ®ä¹‹é—´æ²¡æœ‰å…³ç³»)**ã€‚NoSqlæ•°æ®åº“å¹¶ä¸æ˜¯è¦å–ä»£å…³ç³»å‹æ•°æ®åº“ï¼Œè€Œæ˜¯å…³ç³»å‹æ•°æ®åº“çš„è¡¥å……ã€‚

**å…³ç³»å‹æ•°æ®åº“(RDBMS)ï¼š**
- Mysql
- Oracle
- DB2
- SQLServer

**éå…³ç³»å‹æ•°æ®åº“(NoSql)ï¼š**
- Redis
- Mongo db
- MemCached

https://db-engines.com/ (æ•°æ®åº“æ’è¡Œæ¦œ)

![image-20221210180804729](assets/image-20221210180804729.png)

### 1.2 ğŸ¯ ä½¿ç”¨Redisèƒ½åšä»€ä¹ˆ

- æ•°æ®ç¼“å­˜ â˜…
- æ¶ˆæ¯é˜Ÿåˆ—
- .........

![image-20211211095723721](assets/image-20211211095723721.png)

---

## 2. ğŸ”¢ Redisçš„æ•°æ®ç±»å‹ã€é‡ç‚¹ã€‘

### 2.1 æ•°æ®ç±»å‹ä»‹ç»

#### Redisçš„5ç§æ•°æ®ç±»å‹ ğŸ¨

redisæ˜¯ä¸€ç§é«˜çº§çš„key-valueçš„å­˜å‚¨ç³»ç»Ÿï¼Œé”®æ˜¯stringç±»å‹ï¼Œå…¶ä¸­valueæ”¯æŒäº”ç§æ•°æ®ç±»å‹ï¼š

**é”®(key)ï¼š**
â€‹	ã€1ã€‘é”®ä¸èƒ½é‡å¤
â€‹	ã€2ã€‘ä½œç”¨ï¼šæ ‡è¯†å­˜å‚¨çš„æ•°æ®
â€‹	ã€3ã€‘æ•°æ®ç±»å‹ï¼šstring
â€‹	ã€4ã€‘å‘½åè§„åˆ™ï¼š
â€‹			1ï¼‰ä¸èƒ½å¤ªé•¿ï¼šå› ä¸ºæŸ¥è¯¢çš„æ•ˆç‡ä½ï¼ŒæŸ¥è¯¢èµ·æ¥ä¸æ–¹ä¾¿
â€‹			2ï¼‰ä¸èƒ½å¤ªçŸ­ï¼šå®¹æ˜“é‡å¤ï¼ŒåŒæ—¶å¯è¯»æ€§ä¹Ÿå·®
â€‹			3ï¼‰æŒ‰ç…§è§„èŒƒï¼šHEIMA_STU_LIST

**å€¼(value)ï¼š**æ”¯æŒ5ç§æ•°æ®ç±»å‹

| å€¼çš„æ•°æ®ç±»å‹ | å€¼çš„æ ¼å¼è¯´æ˜ |
|--------------|--------------|
| string | å­—ç¬¦ä¸²ç±»å‹ï¼Œç±»ä¼¼äºJavaä¸­String |
| hash | ç”±é”®å€¼å¯¹ç»„æˆï¼Œç±»ä¼¼äºJavaä¸­Map |
| list | åˆ—è¡¨ç±»å‹ï¼Œç±»ä¼¼äºJavaä¸­Listï¼Œå…ƒç´ æ˜¯å­˜å–æœ‰åºï¼Œå¯ä»¥é‡å¤ |
| set | é›†åˆç±»å‹ï¼Œç±»ä¼¼äºJavaä¸­Setï¼Œå…ƒç´ æ˜¯å­˜å–æ— åºï¼Œä¸å¯é‡å¤ |
| sorted set/zset | æœ‰åºçš„é›†åˆç±»å‹ï¼Œæ¯ä¸ªå…ƒç´ æœ‰ä¸€ä¸ªåˆ†æ•°ç”¨æ¥å†³å®šå®ƒçš„é¡ºåº |

![image-20200208130327354](assets/image-20200208130327354.png)

---

### 2.2 ğŸ“ stringç±»å‹çš„æ“ä½œå‘½ä»¤

#### æ¦‚è¿°
å­—ç¬¦ä¸²ç±»å‹æ˜¯Redisä¸­æœ€ä¸ºåŸºç¡€çš„æ•°æ®å­˜å‚¨ç±»å‹ï¼Œå®ƒåœ¨Redisä¸­ä»¥äºŒè¿›åˆ¶ä¿å­˜ã€‚æ— è®ºå­˜å…¥çš„æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹ç±»å‹éƒ½ä¼šä»¥å­—ç¬¦ä¸²å†™å…¥ã€‚

**åœ¨Redisä¸­å­—ç¬¦ä¸²ç±»å‹çš„å€¼æœ€å¤šå¯ä»¥å®¹çº³çš„æ•°æ®é•¿åº¦æ˜¯512M**ï¼Œè¿™æ˜¯ä»¥åæœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹ã€‚

![1575603138930](assets/1575603138930.png)

#### å¸¸ç”¨å‘½ä»¤ âŒ¨ï¸

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| set é”® å€¼ | æ·»åŠ æˆ–ä¿®æ”¹ä¸€ä¸ªé”®å’Œå€¼ï¼Œé”®ä¸å­˜åœ¨å°±æ˜¯æ·»åŠ ï¼Œå­˜åœ¨å°±æ˜¯ä¿®æ”¹ |
| get é”® | è·å–å€¼ï¼Œå¦‚æœå­˜åœ¨å°±è¿”å›å€¼ï¼Œä¸å­˜åœ¨è¿”å›nil |
| del é”® | åˆ é™¤æŒ‡å®šçš„é”®å’Œå€¼ï¼Œè¿”å›åˆ é™¤çš„ä¸ªæ•° |
| **SETEX** key seconds value | è®¾ç½®æŒ‡å®škeyçš„å€¼ï¼Œå¹¶å°† key çš„è¿‡æœŸæ—¶é—´è®¾ä¸º seconds ç§’ |
| EXPIRE key seconds | å¦‚æœä¸€ä¸ªkeyå·²ç»å­˜åœ¨ï¼Œè¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ |
| **SETNX** key value | ä¿å­˜é”®å€¼å¯¹ï¼Œå¦‚æœkeyå­˜åœ¨åˆ™ä¸ä¿å­˜ï¼Œä¸å­˜åœ¨åˆ™ä¿å­˜ |

**è¡¥å……ï¼šæ‰¹é‡æ“ä½œ**

```redis
mset name lisi addr sh mget name age addr del name age
```


#### å‘½ä»¤æ¼”ç¤º ğŸª

![image-20200209103118414](assets/image-20200209103118414.png)

**è®¾ç½®è¿‡æœŸæ—¶é—´ç¤ºä¾‹ï¼š**
![image-20221211094000743](assets/image-20221211094000743.png)
![image-20221211094621397](assets/image-20221211094621397.png)
![image-20221211095137156](assets/image-20221211095137156.png)
![image-20221211105630850](assets/image-20221211105630850.png)

#### ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ ğŸ’¡
- ç”¨æˆ·ç™»å½•åç«¯ä¿å­˜çŸ­ä¿¡éªŒè¯ç ï¼Œå¹¶è®¾ç½®å¤±æ•ˆæ—¶é—´
- ä»£æ›¿åç«¯sessionåŠŸèƒ½ï¼Œå®ç°åˆ†å¸ƒå¼ç¼“å­˜

#### å°ç»“ âœ…
1. æ·»åŠ å€¼ï¼š `set é”® å€¼`
2. è·å–å€¼ï¼š `get é”®`
3. åˆ é™¤å€¼ï¼š `del é”®`

---

### 2.3 ğŸ“¦ hashç±»å‹çš„æ“ä½œå‘½ä»¤

#### æ¦‚è¿°
Redisä¸­çš„Hashç±»å‹å¯ä»¥çœ‹æˆæ˜¯é”®å’Œå€¼éƒ½æ˜¯Stringç±»å‹çš„Mapå®¹å™¨ï¼Œæ¯ä¸€ä¸ªHashå¯ä»¥å­˜å‚¨4Gä¸ªé”®å€¼å¯¹ã€‚

![1575603212331](assets/1575603212331.png)

è¯¥ç±»å‹éå¸¸é€‚åˆäºå­˜å‚¨å¯¹è±¡çš„ä¿¡æ¯ã€‚å¦‚ä¸€ä¸ªç”¨æˆ·æœ‰å§“åï¼Œå¯†ç ï¼Œå¹´é¾„ç­‰ä¿¡æ¯ã€‚

![1553421986390](assets/1553421986390.png)

#### å¸¸ç”¨å‘½ä»¤ âŒ¨ï¸

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| hset é”® å­—æ®µ å€¼ | æ·»åŠ é”®ï¼Œå­—æ®µï¼Œå€¼ |
| hget é”® å­—æ®µ | é€šè¿‡é”®ï¼Œå­—æ®µå¾—åˆ°å€¼ |
| hmset é”® å­—æ®µ å€¼ å­—æ®µ å€¼ | ä¸€æ¬¡æ·»åŠ å¤šä¸ªå­—æ®µå’Œå€¼ |
| hmget é”® å­—æ®µ å­—æ®µ | é€šè¿‡é”®ï¼Œè·å–å¤šä¸ªå­—æ®µå’Œå€¼ |
| hdel é”® å­—æ®µ å­—æ®µ | åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µçš„å€¼ |
| hgetall é”® | å¾—åˆ°è¿™ä¸ªé”®ä¸‹æ‰€æœ‰çš„å­—æ®µå’Œå€¼ |
| HKEYS é”® | è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å­—æ®µ |
| HVALS é”® | è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼ |

#### å‘½ä»¤æ¼”ç¤º ğŸª

![image-20200209112101650](assets/image-20200209112101650.png)
![image-20221211111001853](assets/image-20221211111001853.png)

#### åº”ç”¨åœºæ™¯ ğŸ›’
**è´­ç‰©è½¦ï¼š** ä»¥ç”¨æˆ·idä¸ºkeyï¼Œå•†å“idä¸ºfieldï¼Œå•†å“æ•°é‡ä¸ºvalue

![image-20221211112839773](assets/image-20221211112839773.png)

#### å°ç»“ âœ…

| åŠŸèƒ½ | hashç±»å‹çš„æ“ä½œå‘½ä»¤ |
|------|-------------------|
| æ·»åŠ å€¼ | hset |
| å¾—åˆ°å€¼ | hget |
| åˆ é™¤å€¼ | hdel |
| æ·»åŠ å¤šä¸ªå­—æ®µ | hmset |
| å¾—åˆ°å¤šä¸ªå­—æ®µå€¼ | hmget |
| å¾—åˆ°æ‰€æœ‰å­—æ®µçš„å€¼ | hgetall |

---

### 2.4 ğŸ“‹ listç±»å‹çš„æ“ä½œå‘½ä»¤

#### æ¦‚è¿°
åœ¨Redisä¸­ï¼ŒListç±»å‹æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºæ’åºçš„å­—ç¬¦ä¸²é“¾è¡¨ã€‚Listä¸­å¯ä»¥åŒ…å«çš„æœ€å¤§å…ƒç´ æ•°é‡æ˜¯4Gä¸ªã€‚

![1575603240218](assets/1575603240218.png)

#### å¸¸ç”¨å‘½ä»¤ âŒ¨ï¸

| å‘½ä»¤ | è¡Œä¸º |
|------|------|
| lpush é”® å…ƒç´  å…ƒç´ ... | ä»å·¦è¾¹å‘æŒ‡å®šçš„é”®ä¸­æ·»åŠ 1ä¸ªæˆ–å¤šä¸ªå…ƒç´  |
| rpush é”® å…ƒç´  å…ƒç´ ... | ä»å³è¾¹å‘æŒ‡å®šçš„é”®ä¸­æ·»åŠ 1ä¸ªæˆ–å¤šä¸ªå…ƒç´  |
| lpop é”® | ä»å·¦è¾¹åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›è¢«åˆ é™¤çš„å…ƒç´  |
| rpop é”® | ä»å³è¾¹åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›è¢«åˆ é™¤çš„å…ƒç´  |
| lrange é”® å¼€å§‹ ç»“æŸ | å¾—åˆ°é”®ä¸­æŒ‡å®šèŒƒå›´çš„å…ƒç´ çš„æ•°æ® |
| lindex é”® ç´¢å¼•å€¼ | æŸ¥è¯¢æŒ‡å®šç´¢å¼•çš„å…ƒç´  |
| llen é”® | è·å–åˆ—è¡¨çš„é•¿åº¦ |
| **BRPOP** key1 [key2 ] timeout | ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶ |
| LREM key åˆ é™¤å…ƒç´ ä¸ªæ•° valueå€¼ | ä»è¡¨å¤´åˆ é™¤æŒ‡å®šä¸ªæ•°çš„å…ƒç´  |

#### å‘½ä»¤æ¼”ç¤º ğŸª

![1553422354555](assets/1553422354555.png)
![image-20200209155159998](assets/image-20200209155159998.png)
![image-20221211114628145](assets/image-20221211114628145.png)
![image-20221211121809402](assets/image-20221211121809402.png)

#### ä½¿ç”¨åœºæ™¯ ğŸ“±
- å¾®ä¿¡æœ‹å‹åœˆç‚¹èµï¼Œè¦æ±‚æŒ‰ç…§ç‚¹èµé¡ºåºæ˜¾ç¤ºç‚¹èµå¥½å‹ä¿¡æ¯
- æ’è¡Œæ¦œå­˜å‚¨ï¼Œå¦‚äº¬ä¸œæ¯æ—¥çš„æ‰‹æœºé”€é‡æ’è¡Œ

![image-20221211122708979](assets/image-20221211122708979.png)

#### å°ç»“ âœ…
1. ä»å·¦è¾¹æ·»åŠ å…ƒç´ : `lpush`
2. ä»å³è¾¹æ·»åŠ å…ƒç´ ï¼š`rpush`
3. ä»å·¦è¾¹åˆ é™¤å…ƒç´ ï¼š`lpop`
4. ä»å³è¾¹åˆ é™¤å…ƒç´ ï¼š`rpop`
5. å¾—åˆ°æŒ‡å®šèŒƒå›´çš„å…ƒç´ ï¼š`lrange`
6. å¾—åˆ°åˆ—è¡¨çš„é•¿åº¦ï¼š`llen`

---

### 2.5 ğŸ¯ setç±»å‹çš„æ“ä½œå‘½ä»¤

#### æ¦‚è¿°
åœ¨Redisä¸­ï¼ŒSetç±»å‹æ˜¯æ²¡æœ‰æ’åºçš„å­—ç¬¦é›†åˆï¼ŒSetå¯åŒ…å«çš„æœ€å¤§å…ƒç´ æ•°é‡æ˜¯4Gï¼ŒSeté›†åˆä¸­ä¸å…è®¸å‡ºç°é‡å¤çš„å…ƒç´ ã€‚

![1553422461249](assets/1553422461249.png)
![image-20200209160724548](assets/image-20200209160724548.png)

#### å¸¸ç”¨å‘½ä»¤ âŒ¨ï¸

| å‘½ä»¤ | è¡Œä¸º |
|------|------|
| sadd é”® å…ƒç´  å…ƒç´ ... | å‘ä¸€ä¸ªé”®ä¸­æ·»åŠ 1ä¸ªæˆ–å¤šä¸ªå…ƒç´  |
| smembers é”® | å¾—åˆ°è¿™ä¸ªé›†åˆä¸­æ‰€æœ‰çš„å…ƒç´  |
| sismember é”® å…ƒç´  | åˆ¤æ–­æŒ‡å®šçš„å…ƒç´ åœ¨é›†åˆä¸­æ˜¯å¦å­˜åœ¨ |
| srem é”® å…ƒç´  å…ƒç´ ... | é€šè¿‡é”®åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´  |
| sinter key1 [key2] | è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›† |

#### å‘½ä»¤æ¼”ç¤º ğŸª

![1565494483459](assets/1565494483459.png)
![1565494529527](assets/1565494529527.png)
![image-20221211160853993](assets/image-20221211160853993.png)

#### åº”ç”¨åœºæ™¯ ğŸ‘¥
- éœ€è¦å»é‡çš„å°‘é‡ä¿¡æ¯ï¼Œå¦‚èº«ä»½è¯ä¿¡æ¯ã€æ‰‹æœºå·ç ç­‰ä½œä¸ºé»‘åå•|ç™½åå•
- å…±åŒå¥½å‹æŸ¥è¯¢ï¼Œä½¿ç”¨setçš„äº¤é›†

#### å°ç»“ âœ…
1. æ·»åŠ å…ƒç´ ï¼š`sadd`
2. åˆ é™¤å…ƒç´ ï¼š`srem`
3. å¾—åˆ°æ‰€æœ‰å…ƒç´ ï¼š`smembers`
4. åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼š`sismember`

---

### 2.6 ğŸ“Š zset/sorted setç±»å‹çš„æ“ä½œå‘½ä»¤

#### æ¦‚è¿°
Redis æœ‰åºé›†åˆï¼ˆsorted setï¼‰å’Œseté›†åˆä¸€æ ·ä¹Ÿæ˜¯æ— åºä¸å¯ä»¥é‡å¤ã€‚ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªåˆ†æ•°(æ’åºå› å­)ã€‚

![1563279583231](assets/1563279583231.png)
![image-20200209181108657](assets/1575606694929.png)

#### å‘½ä»¤ âŒ¨ï¸

| å‘½ä»¤ | è¡Œä¸º |
|------|------|
| **zadd** **é”®** **åˆ†æ•°** **å€¼** | æ·»åŠ 1ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªåˆ†æ•° |
| **zrange** **é”®** **å¼€å§‹ç´¢å¼•** **ç»“æŸç´¢å¼•** | è·å–æŒ‡å®šèŒƒå›´çš„å…ƒç´  |
| **zrange é”® å¼€å§‹ç´¢å¼• ç»“æŸç´¢å¼• withscores** | æŸ¥è¯¢æŒ‡å®šçš„å…ƒç´ å’Œå¯¹åº”çš„åˆ†æ•° |
| **zrevrange é”® å¼€å§‹ç´¢å¼• ç»“æŸç´¢å¼• withscores** | æŒ‰ç…§åˆ†æ•°å€’å™è·å–æŒ‡å®šçš„å…ƒç´ å’Œå¯¹åº”çš„åˆ†æ•° |
| **zrem é”® å€¼ å€¼** | åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ |
| **zcard** **é”®** | å¾—åˆ°å…ƒç´ ä¸ªæ•° |
| **zrank** **é”®** **å€¼** | å¾—åˆ°å…ƒç´ çš„ç´¢å¼•å· |
| **zscore é”® å€¼** | å¾—åˆ°å…ƒç´ çš„åˆ†æ•° |

#### å‘½ä»¤æ¼”ç¤º ğŸª

![1565494974504](assets/1565494974504.png)
![image-20200209183709038](assets/image-20200209183709038.png)
![image-20200209182356035](assets/image-20200209182356035.png)
![1565495068560](assets/1565495068560.png)

#### åº”ç”¨åœºæ™¯ ğŸ“ˆ
1. bç«™è§†é¢‘ç‚¹å‡»é‡æ’å
2. æ–°æµªçƒ­ç‚¹æ–‡ç« ç‚¹å‡»é‡ã€æ”¶è—é‡ç­‰æ’å

#### å°ç»“ âœ…

| å‘½ä»¤ | è¡Œä¸º |
|------|------|
| **zadd** | æ·»åŠ  |
| **zrange** | æŸ¥è¯¢ |
| **zrem** | åˆ é™¤ |
| **zcard** | ä¸ªæ•° |
| **zrank** | ç´¢å¼•å· |
| **zscore** | å¾—åˆ°åˆ†æ•° |

---

## 3. ğŸ”§ Redisçš„å…¶ä»–æ“ä½œ

### 3.1 ğŸ› ï¸ Redisçš„é€šç”¨å‘½ä»¤

#### å¸¸ç”¨å‘½ä»¤ âŒ¨ï¸

| å‘½ä»¤ | åŠŸèƒ½ |
|------|------|
| **keys åŒ¹é…å­—ç¬¦** | æŸ¥è¯¢æ‰€æœ‰çš„é”®ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦<br/>***** åŒ¹é…å¤šä¸ªå­—ç¬¦<br/>**?** åŒ¹é…1ä¸ªå­—ç¬¦ |
| **del** **é”®1** **é”®2** | åˆ é™¤ä»»ä½•çš„å€¼ç±»å‹ï¼Œè€Œä¸”å¯ä»¥åŒæ—¶åˆ é™¤å¤šä¸ªé”® |
| **exists** **é”®** | åˆ¤æ–­æŒ‡å®šçš„é”®æ˜¯å¦å­˜åœ¨ |
| **type** **é”®** | åˆ¤æ–­æŒ‡å®šçš„é”®ï¼Œå€¼çš„ç±»å‹ |
| **select** **æ•°æ®åº“ç¼–å·** | é€‰æ‹©å…¶å®ƒçš„æ•°æ®åº“ |
| **move** **é”®** **æ•°æ®åº“ç¼–å·** | å°†å½“å‰æ•°æ®åº“ä¸­æŒ‡å®šçš„é”®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ä¸­ |
| **TTL** key | è¿”å›ç»™å®š key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ |
| flushall | æ¸…ç©ºredisæ‰€æœ‰çš„åº“ |

#### å‘½ä»¤æ¼”ç¤º ğŸª

![1565505801233](assets/1565505801233.png)
![1565505942936](assets/1565505942936.png)
![1565506128394](assets/1565506128394.png)
![image-20221211162822565](assets/image-20221211162822565.png)

#### å°ç»“ âœ…
1. **keys**ï¼šæ‰¾åˆ°æ‰€æœ‰çš„é”®ï¼Œé€šé…ç¬¦ï¼š* ?
2. existsï¼šåˆ¤æ–­æŒ‡å®šçš„é”®æ˜¯å¦å­˜åœ¨
3. typeï¼šåˆ¤æ–­æŒ‡å®šé”®å€¼çš„ç±»å‹
4. **select**ï¼šåˆ‡æ¢æ•°æ®åº“é»˜è®¤æ˜¯0-15
5. moveï¼šå°†é”®ç§»åŠ¨å¦ä¸€ä¸ªæ•°æ®åº“
6. **del**: åˆ é™¤å¤šä¸ªé”®

---

## 4. â˜• åœ¨Javaä¸­æ“ä½œRedis

### 4.1 ğŸ¯ ä»‹ç»

å‰é¢æˆ‘ä»¬è®²è§£äº†Redisçš„å¸¸ç”¨å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æ˜¯æˆ‘ä»¬æ“ä½œRedisçš„åŸºç¡€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨javaç¨‹åºä¸­åº”è¯¥å¦‚ä½•æ“ä½œRediså‘¢ï¼Ÿè¿™å°±éœ€è¦ä½¿ç”¨Redisçš„Javaå®¢æˆ·ç«¯ï¼Œå°±å¦‚åŒæˆ‘ä»¬ä½¿ç”¨JDBCæ“ä½œMySQLæ•°æ®åº“ä¸€æ ·ã€‚

Redis çš„ Java å®¢æˆ·ç«¯å¾ˆå¤šï¼Œå®˜æ–¹æ¨èçš„æœ‰ä¸‰ç§ï¼š
- Jedis
- Lettuce
- Redisson

Spring å¯¹ Redis å®¢æˆ·ç«¯è¿›è¡Œäº†æ•´åˆï¼Œæä¾›äº† Spring Data Redisï¼Œåœ¨Spring Booté¡¹ç›®ä¸­è¿˜æä¾›äº†å¯¹åº”çš„Starterï¼Œå³ spring-boot-starter-data-redisã€‚

### 4.2 ğŸ”Œ Jedis(ç†è§£)

#### 1.Jedisä½¿ç”¨ä»‹ç»

Jedis æ˜¯ Redis çš„ Java ç‰ˆæœ¬çš„å®¢æˆ·ç«¯å®ç°ã€‚

mavenåæ ‡ï¼š
```xml
<dependency>
	<groupId>redis.clients</groupId>
	<artifactId>jedis</artifactId>
	<version>2.8.0</version>
</dependency>
```

#### 2. Jedisç±»å¸¸ç”¨æ–¹æ³• ğŸ“‹

æ³¨ï¼šæ¯ä¸ªæ–¹æ³•å°±æ˜¯redisä¸­çš„å‘½ä»¤åï¼Œæ–¹æ³•çš„å‚æ•°å°±æ˜¯å‘½ä»¤çš„å‚æ•°ã€‚

| **è¿æ¥å’Œå…³é—­** | **åŠŸèƒ½** |
|----------------|----------|
| **new Jedis(host, port)** | åˆ›å»ºJedisè¿æ¥å¯¹è±¡ |
| **void close()** | å…³é—­è¿æ¥ |

| **å¯¹stringæ“ä½œçš„æ–¹æ³•** | **è¯´æ˜** |
|------------------------|----------|
| **set(String key,String value)** | æ·»åŠ å­—ç¬¦ä¸²ç±»å‹çš„é”®å’Œå€¼ |
| **String get(String key)** | é€šè¿‡é”®å¾—åˆ°å­—ç¬¦ä¸²çš„å€¼ |
| **del(String ... keys)** | åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”® |

| **å¯¹hashæ“ä½œçš„æ–¹æ³•** | **è¯´æ˜** |
|----------------------|----------|
| **hset(String key,String field,String value)** | æ·»åŠ ä¸€ä¸ªhashç±»å‹çš„é”®ï¼Œå­—æ®µå’Œå€¼ |
| **Map<String,String> hgetall(String key)** | é€šè¿‡ä¸€ä¸ªé”®å¾—åˆ°æ‰€æœ‰çš„å­—æ®µå’Œå€¼ |

#### 3. æ¡ˆä¾‹ï¼šJedisçš„åŸºæœ¬æ“ä½œ ğŸ’»

##### æ“ä½œå­—ç¬¦ä¸²æ•°æ®
```java
public class JedisTest01 {
    @Test
    public void test01(){
        //1.åˆ›å»ºjediså¯¹è±¡ï¼Œè¿æ¥redisæ•°æ®åº“æœåŠ¡å™¨
        Jedis jedis = new Jedis("127.0.0.1",6379);
        
        //2.æ“ä½œæ•°æ® - å­—ç¬¦ä¸²
        jedis.set("username", "æŸ³å²©");
        String username = jedis.get("username");
        System.out.println("username = " + username);
        
        //ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªæ•°æ®
        jedis.mset("addr", "sh", "company", "é»‘é©¬");
        List<String> values = jedis.mget("username", "addr", "company");
        System.out.println("values = " + values);
        
        //3.å…³é—­è¿æ¥
        jedis.close();
    }
}
```

æ§åˆ¶å°è¾“å‡ºç»“æœï¼š
![image-20200212172111495](assets/image-20200212172111495.png)

##### æ“ä½œhashæ•°æ®
```java
@Test
public void test01(){
    //1.åˆ›å»ºjediså¯¹è±¡ï¼Œè¿æ¥redisæ•°æ®åº“æœåŠ¡å™¨
    Jedis jedis = new Jedis("127.0.0.1",6379);
    
    //2.æ“ä½œæ•°æ® - hash
    jedis.hset("person", "username", "é”å“¥");
    
    //å­˜å‚¨å¤šä¸ªæ•°æ®
    Map<String, String> map = new HashMap<>();
    map.put("age", "18");
    map.put("height", "180");
    jedis.hmset("person", map);
    
    //è·å–hashä¸­çš„æ‰€æœ‰çš„æ•°æ®
    Map<String, String> map1 = jedis.hgetAll("person");
    System.out.println(map1);
    
    //3.å…³é—­è¿æ¥
    jedis.close();
}
```

æ§åˆ¶å°è¾“å‡ºç»“æœï¼š
![image-20200212173846415](assets/image-20200212173846415.png)

---

### 4.3 ğŸš€ Spring Data Redis(æŒæ¡)

#### 4.3.1 ä»‹ç»

Spring Data Redis æ˜¯ Spring çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†åœ¨ Spring åº”ç”¨ä¸­é€šè¿‡ç®€å•çš„é…ç½®å°±å¯ä»¥è®¿é—® Redis æœåŠ¡ï¼Œå¯¹ Redis åº•å±‚å¼€å‘åŒ…è¿›è¡Œäº†é«˜åº¦å°è£…ã€‚

mavenåæ ‡ï¼š
```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

Spring Data Redisä¸­æä¾›äº†ä¸€ä¸ªé«˜åº¦å°è£…çš„ç±»ï¼š**RedisTemplate**ï¼Œé’ˆå¯¹ç±»ä¼¼ Jedis å®¢æˆ·ç«¯ä¸­å¤§é‡apiè¿›è¡Œäº†å½’ç±»å°è£…ï¼š
- ValueOperationsï¼šç®€å•K-Væ“ä½œ(Stringç±»å‹)
- SetOperationsï¼šsetç±»å‹æ•°æ®æ“ä½œ
- ZSetOperationsï¼šzsetç±»å‹æ•°æ®æ“ä½œ
- HashOperationsï¼šé’ˆå¯¹hashç±»å‹çš„æ•°æ®æ“ä½œ
- ListOperationsï¼šé’ˆå¯¹listç±»å‹çš„æ•°æ®æ“ä½œ

#### 4.3.2 ä½¿ç”¨æ–¹å¼

##### ç¯å¢ƒæ­å»º

**ç¬¬ä¸€æ­¥ï¼šé…ç½®pom.xmlæ–‡ä»¶**
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-test</artifactId>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-redis</artifactId>
    </dependency>
</dependencies>
```

**ç¬¬äºŒæ­¥ï¼šç¼–å†™å¯åŠ¨ç±»**
```java
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class,args);
    }
}
```

**ç¬¬ä¸‰æ­¥ï¼šé…ç½®application.yml**
```yaml
spring:
  #Redisç›¸å…³é…ç½®
  redis:
    host: 192.168.88.128 # è¿æ¥linuxç³»ç»Ÿçš„redis
    port: 6379 # ç«¯å£å·
    database: 0 #æ“ä½œçš„æ˜¯0å·æ•°æ®åº“
```

**ç¬¬å››æ­¥ï¼šæä¾›æµ‹è¯•ç±»**
```java
@SpringBootTest
public class SpringDataRedisTest {
    @Autowired
    private RedisTemplate redisTemplate;
}
```

##### æ“ä½œå­—ç¬¦ä¸²ç±»å‹æ•°æ®
```java
/**
 * æ“ä½œStringç±»å‹çš„æ•°æ®
 */
@Test
public void test01String(){
    //è·å–æ“ä½œStringç±»å‹çš„æ¥å£å¯¹è±¡
    ValueOperations valueOperations = redisTemplate.opsForValue();
    
    //å­˜å€¼
    valueOperations.set("city123","beijing");
    String value = (String) valueOperations.get("city123");
    System.out.println(value);
    
    //å­˜å€¼ï¼ŒåŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´
    valueOperations.set("username","suoge",10, TimeUnit.SECONDS);
    
    //å­˜å€¼ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œ
    Boolean aBoolean = valueOperations.setIfAbsent("city1234", "nanjing");
    System.out.println(aBoolean);
}
```

##### æ“ä½œå“ˆå¸Œç±»å‹æ•°æ®
```java
/**
 * æ“ä½œHashç±»å‹æ•°æ®
*/
@Test
public void testHash(){
    //è·å–æ“ä½œHashç±»å‹çš„æ¥å£å¯¹è±¡
    HashOperations hashOperations = redisTemplate.opsForHash();
    
    //å­˜å€¼
    hashOperations.put("person","name","xiaoming");
    hashOperations.put("person","age","20");
    hashOperations.put("person","address","bj");
    
    //å–å€¼
    String age = (String) hashOperations.get("person", "age");
    System.out.println(age);
    
    //è·å¾—hashç»“æ„ä¸­çš„æ‰€æœ‰å­—æ®µ
    Set keys = hashOperations.keys("person");
    for (Object key : keys) {
        System.out.println(key);
    }
    
    //è·å¾—hashç»“æ„ä¸­çš„æ‰€æœ‰å€¼
    List values = hashOperations.values("person");
    for (Object value : values) {
        System.out.println(value);
    }
}
```

##### æ“ä½œåˆ—è¡¨ç±»å‹æ•°æ®
```java
/**
 * æ“ä½œListç±»å‹çš„æ•°æ®
*/
@Test
public void testList(){
    //è·å–æ“ä½œåˆ—è¡¨ç±»å‹çš„æ¥å£å¯¹è±¡
    ListOperations listOperations = redisTemplate.opsForList();
    
    //å­˜å€¼
    listOperations.leftPush("mylist","a");
    listOperations.leftPushAll("mylist","b","c","d");
    
    //å–å€¼
    List<String> mylist = listOperations.range("mylist", 0, -1);
    for (String value : mylist) {
        System.out.println(value);
    }
    
    //è·å¾—åˆ—è¡¨é•¿åº¦
    Long size = listOperations.size("mylist");
    for (int i = 0; i < size; i++) {
        //å‡ºé˜Ÿåˆ—
        String element = (String) listOperations.rightPop("mylist");
        System.out.println(element);
    }
}
```

##### æ“ä½œseté›†åˆç±»å‹æ•°æ®
```java
/**
 * æ“ä½œSetç±»å‹çš„æ•°æ®
*/
@Test
public void testSet(){
    //è·å–æ“ä½œsetç±»å‹çš„æ¥å£å¯¹è±¡
    SetOperations setOperations = redisTemplate.opsForSet();
    
    //å­˜å€¼
    setOperations.add("myset","a","b","c","a");
    
    //å–å€¼
    Set<String> myset = setOperations.members("myset");
    for (String o : myset) {
        System.out.println(o);
    }
    
    //åˆ é™¤æˆå‘˜
    setOperations.remove("myset","a","b");
    
    //å–å€¼
    myset = setOperations.members("myset");
    for (String o : myset) {
        System.out.println(o);
    }
}
```

##### æ“ä½œæœ‰åºé›†åˆç±»å‹æ•°æ®
```java
/**
 * æ“ä½œZSetç±»å‹çš„æ•°æ®
*/
@Test
public void testZset(){
    //è·å–æ“ä½œzSetç±»å‹çš„æ¥å£å¯¹è±¡
    ZSetOperations zSetOperations = redisTemplate.opsForZSet();
    
    //å­˜å€¼
    zSetOperations.add("myZset","a",10.0);
    zSetOperations.add("myZset","b",11.0);
    zSetOperations.add("myZset","c",12.0);
    zSetOperations.add("myZset","a",13.0);
    
    //å–å€¼
    Set<String> myZset = zSetOperations.range("myZset", 0, -1);
    for (String s : myZset) {
        System.out.println(s);
    }
    
    //ä¿®æ”¹åˆ†æ•°
    zSetOperations.incrementScore("myZset","c",20.0);
    
    //åˆ é™¤æˆå‘˜
    zSetOperations.remove("myZset","a","b");
    
    //å–å€¼
    Set<ZSetOperations.TypedTuple> myZset = zSetOperations.rangeWithScores("myZset", 0, -1);
    for (ZSetOperations.TypedTuple typedTuple : myZset) {
        Double score = typedTuple.getScore();
        Object value = typedTuple.getValue();
        System.out.println(score+"---"+value);
    }
}
```

##### é€šç”¨æ“ä½œ
```java
/**
 * é€šç”¨æ“ä½œï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹éƒ½å¯ä»¥æ“ä½œ
*/
@Test
public void testCommon(){
    //è·å–Redisä¸­æ‰€æœ‰çš„key
    Set<String> keys = redisTemplate.keys("*");
    for (String key : keys) {
        System.out.println(key);
    }
    
    //åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨
    Boolean itcast = redisTemplate.hasKey("itcast");
    System.out.println(itcast);
    
    //åˆ é™¤æŒ‡å®škey
    redisTemplate.delete("myZset");
    
    //è·å–æŒ‡å®škeyå¯¹åº”çš„valueçš„æ•°æ®ç±»å‹
    DataType dataType = redisTemplate.type("myset");
    System.out.println(dataType.name());
}
```

##### æ•´åˆè¿æ¥æ± 
pomå¼•å…¥ä¾èµ–ï¼š
```xml
<!-- redisåˆ›å»ºè¿æ¥æ± ï¼Œé»˜è®¤ä¸ä¼šåˆ›å»ºè¿æ¥æ±  -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-pool2</artifactId>
</dependency>
```

é…ç½®è¿æ¥æ± ï¼š
```yaml
# é…ç½®redisç¯å¢ƒ
spring:
  redis:
    host: 192.168.200.128
    port: 6379
    database: 0
    lettuce:
      pool:
        max-active: 8 # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°
        max-wait: -1ms # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´
        max-idle: 8 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥
        min-idle: 1  # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥
```

---

## 5. ğŸ’¾ RedisæŒä¹…åŒ–æœºåˆ¶-æ‰©å±•

### 5.1 ğŸ” RedisæŒä¹…åŒ–[äº†è§£]

#### é—®é¢˜ ğŸ¤”
**é—®ï¼šæŠŠæœåŠ¡ç«¯å…³é—­äº†ï¼Œå†é‡æ–°å¼€å¯æœåŠ¡å™¨ï¼Œæ•°æ®ä¼šä¸ä¼šä¸¢å¤±ï¼Ÿ**

- ä¼šéƒ¨åˆ†ä¸¢å¤±ï¼Œå› ä¸ºé»˜è®¤redisæœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´å†™å…¥ä¸€æ¬¡å†…å­˜ä¸­æ•°æ®åˆ°ç¡¬ç›˜ä¸Šã€‚


#### æ¦‚è¿° ğŸ“–
**ä»€ä¹ˆæ˜¯Redisçš„æŒä¹…åŒ–ï¼š**
Redisæ˜¯ä¸€ä¸ªå†…å­˜å­˜å‚¨çš„æ•°æ®åº“ï¼Œå†…å­˜å¿…é¡»åœ¨é€šç”µçš„æƒ…å†µä¸‹æ‰èƒ½å¤Ÿå¯¹æ•°æ®è¿›è¡Œå­˜å‚¨ã€‚ä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œredisæä¾›äº†æ•°æ®æŒä¹…åŒ–çš„æ”¯æŒã€‚

**æŒä¹…åŒ–ï¼š** æŠŠå†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šã€‚
**ä½œç”¨ï¼š** é˜²æ­¢æ•°æ®åœ¨æ–­ç”µçš„æƒ…å†µä¸‹ä¸¢å¤±ã€‚

![image-20200211102120888](assets/image-20200211102120888.png)

**RedisæŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼ï¼š**
1. **RDB**ï¼šRedis DataBase é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ï¼Œä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å°†æ•°æ®å†™å…¥æ–‡ä»¶ä¸­
2. **AOF**ï¼šAppend Only File ä»¥æ–‡æœ¬æ–‡ä»¶çš„æ–¹å¼è®°å½•ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œ

---

### 5.2 ğŸ“¸ RDBæŒä¹…åŒ–ä»‹ç»[äº†è§£]

RDBæ˜¯é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚è¿™ç§æ–¹å¼å°±æ˜¯å°†å†…å­˜ä¸­æ•°æ®ä»¥å¿«ç…§çš„æ–¹å¼å†™å…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œé»˜è®¤çš„æ–‡ä»¶åä¸ºï¼š**dump.rdb**

**å¿«ç…§ï¼š** å½“å‰å†…å­˜ä¸­æ•°æ®çš„çŠ¶æ€ã€‚

![image-20200211105359322](assets/image-20200211105359322.png)

**RDBæŒä¹…åŒ–æ—¶æœºï¼š**

| **å…³é”®å­—** | **æ—¶é—´(ç§’)** | **ä¿®æ”¹é”®æ•°** | **è§£é‡Š** |
|------------|--------------|--------------|----------|
| **save** | **900** | **1** | åˆ°äº†15åˆ†é’Ÿä¿®æ”¹äº†1ä¸ªé”®ï¼Œåˆ™å‘èµ·å¿«ç…§ä¿å­˜ |
| **save** | **300** | **10** | åˆ°äº†5åˆ†é’Ÿä¿®æ”¹äº†10ä¸ªé”®ï¼Œåˆ™å‘èµ·å¿«ç…§ä¿å­˜ |
| **save** | **60** | **10000** | åˆ°äº†1åˆ†é’Ÿï¼Œä¿®æ”¹äº†1ä¸‡ä¸ªé”®ï¼Œåˆ™å‘èµ·å¿«ç…§ä¿å­˜ |

![image-20221214154802305](assets/image-20221214154802305.png)

**RDBä¼˜ç¼ºç‚¹ï¼š**
- **ç¼ºç‚¹ï¼š** å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå› ä¸ºRDBæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´å†™å…¥æ•°æ®
- **ä¼˜ç‚¹ï¼š** æŒä¹…åŒ–æ•ˆç‡é«˜ï¼Œæ•°æ®æ¢å¤çš„æ•ˆç‡è¦æ›´é«˜ï¼Œæ€§èƒ½æœ€å¤§åŒ–

---

### 5.3 ğŸ“ AOFçš„å­˜å‚¨æ–¹å¼[äº†è§£]

#### AOFæŒä¹…åŒ–ç®€ä»‹
ç”±äºå¿«ç…§æ–¹å¼æ˜¯åœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡çš„ï¼Œæ‰€ä»¥å¦‚æœrediså®•æœºï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚

AOFæŒ‡çš„æ˜¯Append only fileï¼Œä½¿ç”¨AOFæŒä¹…åŒ–æ–¹å¼æ—¶ï¼Œredisä¼šå°†æ¯ä¸€ä¸ªæ”¶åˆ°çš„å†™å‘½ä»¤éƒ½é€šè¿‡writeå‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­(é»˜è®¤æ˜¯appendonly.aof)ã€‚

![image-20200211210914131](assets/image-20200211210914131.png)
![image-20200211210933936](assets/image-20200211210933936.png)

**Redisä¸­æä¾›äº†3ç§åŒæ­¥ç­–ç•¥ï¼š**

| **Redisä¸­æä¾›äº†3ç§åŒæ­¥ç­–ç•¥** | **è¯´æ˜** |
|------------------------------|----------|
| **æ¯ç§’åŒæ­¥** | æ¯è¿‡ä¸€ç§’è®°å½•ä¸€æ¬¡ |
| **æ¯ä¿®æ”¹åŒæ­¥** | æ¯æ¬¡ä¿®æ”¹(å¢åˆ æ”¹)éƒ½ä¼šè®°å½•ä¸€æ¬¡ |
| **ä¸åŒæ­¥** | ç”±ç³»ç»Ÿè®°å½•æ“ä½œ |

#### AOFæŒä¹…åŒ–æœºåˆ¶é…ç½®

##### å¼€å¯AOFæŒä¹…åŒ–
AOFé»˜è®¤æ˜¯å…³é—­çš„ï¼Œé¦–å…ˆéœ€è¦å¼€å¯AOFæ¨¡å¼

| **å‚æ•°é…ç½®** | **è¯´æ˜** |
|--------------|----------|
| **appendonly no/yes** | é»˜è®¤æ˜¯noï¼Œå…³é—­ã€‚å¦‚æœè¦æ‰“å¼€ï¼Œè®¾ç½®æˆyes |

##### AOFæŒä¹…åŒ–æ—¶æœº
| **å…³é”®å­—** | **æŒä¹…åŒ–æ—¶æœº** | **è§£é‡Š** |
|------------|----------------|----------|
| **appendfsync** | **everysec** | æ¯ç§’è®°å½• |
| **appendfsync** | **always** | æ¯ä¿®æ”¹è®°å½• |
| **appendfsync** | **no** | å®Œå…¨ä¾èµ–æ“ä½œç³»ç»Ÿ |

**everysec**ï¼šæ¯ç§’é’Ÿå†™å…¥ç£ç›˜ä¸€æ¬¡ï¼Œåœ¨æ€§èƒ½å’ŒæŒä¹…åŒ–æ–¹é¢åšäº†å¾ˆå¥½çš„æŠ˜ä¸­ã€‚
**always**ï¼šæ”¶åˆ°å†™å‘½ä»¤å°±ç«‹å³å†™å…¥ç£ç›˜ï¼Œæœ€æ…¢ï¼Œä½†æ˜¯ä¿è¯å®Œå…¨çš„æŒä¹…åŒ–ã€‚
**no**ï¼šå®Œå…¨ä¾èµ–æ“ä½œç³»ç»Ÿï¼Œæ€§èƒ½æœ€å¥½ï¼ŒæŒä¹…åŒ–æ— æ³•ä¿è¯ã€‚

##### æ¼”ç¤ºï¼šAOFçš„æŒä¹…åŒ–

1. æ‰“å¼€AOFçš„é…ç½®æ–‡ä»¶redis.confï¼Œè®¾ç½®appendonly yes
   ![image-20221214160007849](assets/image-20221214160007849.png)
   ![image-20221214160122312](assets/image-20221214160122312.png)
   ![image-20200211234423632](assets/image-20200211234423632.png)

2. é€šè¿‡./redis-server redis.confå¯åŠ¨æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ç›®å½•ä¸‹å‡ºç°appendonly.aofæ–‡ä»¶

   ![image-20221214160331457](assets/image-20221214160331457.png)
   ![image-20221214160517810](assets/image-20221214160517810.png)

3. æ·»åŠ 3ä¸ªé”®å’Œå€¼
   ![1553423644984](assets/1553423644984.png)

4. æ‰“å¼€appendonly.aofæ–‡ä»¶ï¼ŒæŸ¥çœ‹æ–‡ä»¶çš„å˜åŒ–
   ![image-20221214160700964](assets/image-20221214160700964.png)
   ![image-20200211234841553](assets/image-20200211234841553.png)

**å°ç»“**
1. AOFæ˜¯çš„æ ¼å¼ï¼šæ–‡æœ¬æ–‡ä»¶
2. æ–‡ä»¶å: appendonly.aof
3. ä¸‰ç§é…ç½®ç­–ç•¥
    - æ¯ç§’è®°å½•
    - æ¯ä¿®æ”¹è®°å½•
    - ä¸è®°å½•

---

### 5.4 ğŸ” RedisæŒä¹…åŒ–æœºåˆ¶RDBå’ŒAOFçš„åŒºåˆ«

#### 1.RDBæŒä¹…åŒ–æœºåˆ¶ä¼˜ç‚¹å’Œç¼ºç‚¹

##### ä¼˜ç‚¹ âœ…
1. æ–¹ä¾¿å¤‡ä»½ä¸æ¢å¤
2. å¯åŠ¨æ•ˆç‡æ›´é«˜
3. æ€§èƒ½æœ€å¤§åŒ–

##### ç¼ºç‚¹ âŒ
1. ä¸èƒ½å®Œå…¨é¿å…æ•°æ®ä¸¢å¤±
2. ä¼šå¯¼è‡´æœåŠ¡å™¨æš‚åœçš„ç°è±¡

#### 2.AOFæŒä¹…åŒ–æœºåˆ¶ä¼˜ç‚¹å’Œç¼ºç‚¹

##### ä¼˜ç‚¹ âœ…
AOFåŒ…å«ä¸€ä¸ªæ ¼å¼æ¸…æ™°ã€æ˜“äºç†è§£çš„æ—¥å¿—æ–‡ä»¶ç”¨äºè®°å½•æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œï¼Œå¯ä»¥å¸¦æ¥æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ã€‚

##### ç¼ºç‚¹ âŒ
1. è¿è¡Œæ•ˆç‡æ¯”RDBæ›´æ…¢
2. æ–‡ä»¶æ¯”RDBæ›´å¤§

**ä¸€èˆ¬åœ¨ä¼ä¸šå¼€å‘ä¸­ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ä¼šé…åˆç€ä½¿ç”¨ã€‚**